FROM ubuntu:latest

FROM python:3.12-alpine

ENV PYTHONDONTWRITEBYTECODE 1

ENV PYTHONBUFFERED=1

RUN mkdir /backend

WORKDIR /backend

COPY . /backend/

RUN pip install -r requirements.txt

EXPOSE 8000

ARG POSTGRES_USER
ARG POSTGRES_PASSWORD
ARG POSTGRES_HOST
ARG SECRET_KEY
ARG DEBUG
ARG CORS_ALLOWED_ORIGIN
ARG REACT_APP_ALLOWED_HOST
ARG FRONTEND_IP
ARG BACKEND_IP

ENV POSTGRES_USER=${POSTGRES_USER}
ENV POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
ENV POSTGRES_HOST=${POSTGRES_HOST}
ENV SECRET_KEY=${SECRET_KEY}
ENV DEBUG=${DEBUG}
ENV CORS_ALLOWED_ORIGIN = ${CORS_ALLOWED_ORIGIN}
ENV REACT_APP_ALLOWED_HOST=${REACT_APP_ALLOWED_HOST}
ENV FRONTEND_IP=${FRONTEND_IP}
ENV BACKEND_IP=${BACKEND_IP}

RUN python ./demoproject/manage.py makemigrations

RUN python ./demoproject/manage.py migrate

CMD ["python", "./demoproject/manage.py", "runserver", "0.0.0.0:8000"]